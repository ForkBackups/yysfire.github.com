<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <title>命令行环境下为OpenShift PaaS平台部署Snova</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="幽谷奇峰">

    <!-- Le styles -->
    <link href="../bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>
    <link href="../bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet">
    <link href="../google-code-prettify/sons-of-obsidian.css" rel="stylesheet">
    <link href="../mystyle.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="../ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../ico/apple-touch-icon-57-precomposed.png">
  </head>
  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="../main.html">幽谷奇峰</a>
          <div class="nav-collapse">
            <ul class="nav">
              <li class="active"><a href="../main.html">主页</a></li>
              <li><a href="../linux/main.html">Linux</a></li>
              <li><a href="../vim/main.html">Vim</a></li>
              <li><a href="../web/main.html">前端</a></li>
              <li><a href="../c_cpp/main.html">C和C++</a></li>
              <li><a href="../python/main.html">Python</a></li>
              <li class="divider-vertical"></li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">联系我 <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="https://twitter.com/yysfirecn">@推一推我</a></li>
                  <li><a href="https://www.facebook.com/yysfire">君要你死</a></li>
                  <li><a href="../about.html">给我写信</a></li>
                </ul> <!--/.dropdown-menu -->
              </li> <!--/.dropdown -->
            </ul> <!--/.nav -->
          </div> <!--/.nav-collapse -->

          <div class="pull-right">
            <form class="navbar-search" action="../search.html">
              <!--<div class="input-append">-->
                <input type="text" name="q" class="search-query input-medium" placeholder="搜索">
                <button type="submit" class="icon nav-search"><i class="icon-search icon-white"></i></button>
              <!--</div>-->
            </form>
          </div>

        </div> <!-- /.container -->
      </div> <!--/.navbar-inner-->
    </div> <!--/.navbar-->
    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span9">
          <ul class="breadcrumb">
            <li>
            <a href="../main.html">首页</a> <span class="divider">/</span>
            </li>
            <li class="active">你的位置</li>
          </ul>
          

<h1 id="toc_1">安装客户端部署工具</h1>
<p>
客户端部署工具为rhc，它依赖Ruby，同时会用到Git，因此要先安装Ruby和Git。这两个工具的安装依据不同的操作系统而不同，这里就不赘述。
</p>

<p>
安装好Ruby后，运行：
</p>
<pre>
gem install rhc
</pre>

<p>
gem安装rhc可能被防火墙中断，可能需要设置代理（经验证，无法使用Goagent），例如：
</p>
<pre>
gem install rhc --http-proxy http://127.0.0.1:8080
</pre>

<p>
可运行：
</p>
<pre>
rhc --version
</pre>
<p>
来验证安装是否成功。
</p>

<p>
若要更新rhc到最新版本，可运行：
</p>
<pre>
gem update rhc
</pre>

<p>
如果还没有OpenShift帐号，可以利用安装的这段时间注册一个，注册链接：<a href="https://www.openshift.com/app/account/new">https://www.openshift.com/app/account/new</a>
</p>

<h1 id="toc_2">配置客户端部署工具</h1>
<p>
在创建和部署应用程序之前，要先对rhc进行一下配置，通过运行命令<code>rhc setup</code>来启动配置向导：
</p>
<pre>
$ rhc setup
DL is deprecated, please use Fiddle
OpenShift Client Tools (RHC) Setup Wizard

This wizard will help you upload your SSH keys, set your application namespace, and check that other programs like Git
are properly installed.

If you have your own OpenShift server, you can specify it now. Just hit enter to use the server for OpenShift Online:
openshift.redhat.com.
Enter the server hostname: |openshift.redhat.com| &lt;Enter键&gt;
</pre>

<h2 id="toc_2.1">登陆信息</h2>
<p>
按下回车键后，会提示你输入OpenShift帐号信息：
</p>
<pre>
You can add more servers later using 'rhc server'.

Login to openshift.redhat.com: user@mail.com
Password: ****************
</pre>

<h2 id="toc_2.2">认证Token</h2>
<p>
配置向导接下来会提示你生成一个认证token，回答yes：
</p>
<pre>
OpenShift can create and store a token on disk which allows to you to access the server without using your password. The

key is stored in your home directory and should be kept secret.  You can delete the key at any time by running 'rhc
logout'.
Generate a token now? (yes|no) &lt;yes&gt;
Generating an authorization token for this client ... lasts about 1 month

Saving configuration to D:\DevPack\msys64\home\Administrator\.openshift\express.conf ... done
</pre>

<h2 id="toc_2.3">SSH keys</h2>
<p>
接下来，配置向导会生成一个SSH密钥对，以便将本地客户端认证到远端服务器。
</p>
<pre>
No SSH keys were found. We will generate a pair of keys for you.

    Created: D:/DevPack/msys64/home/Administrator/.ssh/id_rsa.pub

Your public SSH key must be uploaded to the OpenShift server to access code.  Upload now? (yes|no) &lt;yes&gt;
</pre>

<h2 id="toc_2.4">提示安装Git</h2>
<p>
接着，配置向导会提示你安装Git：
</p>
<pre>
In order to fully interact with OpenShift you will need to install and configure a git client if you have not already
done so.

Documentation for installing other tools you will need for OpenShift can be found at
https://www.openshift.com/developers/install-the-client-tools

We recommend these free applications:

  * Git for Windows - a basic git command line and GUI client https://github.com/msysgit/msysgit/wiki/InstallMSysGit
  * TortoiseGit - git client that integrates into the file explorer http://code.google.com/p/tortoisegit/
</pre>

<h2 id="toc_2.5">Domain(namespace)</h2>
<p>
配置向导接着会检查你的OpenShift云端环境是否存在domain(namespace)，这是创建应用程序必须的。以下示例是还没有domain的情况，若已经存在domain，这里会显示出来。
</p>
<pre>
Checking for a domain ... none

Applications are grouped into domains - each domain has a unique name (called a namespace) that becomes part of your
public application URL. You may create your first domain here or leave it blank and use 'rhc create-domain' later. You
will not be able to create an application without completing this step.

Please enter a namespace (letters and numbers only) |&lt;none&gt;|:
</pre>
<p>
在这里输入你的domain(namespace)，只能包含字母和数字。
</p>

<h2 id="toc_2.6">Applications</h2>
<p>
最后，配置向导会检查服务器上是否存在应用程序。以下示例是没有应用程序的情况：
</p>
<pre>
Checking for applications ... none

Run 'rhc create-app' to create your first application.

  Do-It-Yourself 0.1                      rhc create-app &lt;app name&gt; diy-0.1
  JBoss Application Server 7              rhc create-app &lt;app name&gt; jbossas-7
  JBoss Data Virtualization 6             rhc create-app &lt;app name&gt; jboss-dv-6.0.0
  JBoss Enterprise Application Platform 6 rhc create-app &lt;app name&gt; jbosseap-6
  Jenkins Server                          rhc create-app &lt;app name&gt; jenkins-1
  Node.js 0.10                            rhc create-app &lt;app name&gt; nodejs-0.10
  PHP 5.3                                 rhc create-app &lt;app name&gt; php-5.3
  PHP 5.4                                 rhc create-app &lt;app name&gt; php-5.4
  PHP 5.4 with Zend Server 6.1            rhc create-app &lt;app name&gt; zend-6.1
  Perl 5.10                               rhc create-app &lt;app name&gt; perl-5.10
  Python 2.6                              rhc create-app &lt;app name&gt; python-2.6
  Python 2.7                              rhc create-app &lt;app name&gt; python-2.7
  Python 3.3                              rhc create-app &lt;app name&gt; python-3.3
  Ruby 1.8                                rhc create-app &lt;app name&gt; ruby-1.8
  Ruby 1.9                                rhc create-app &lt;app name&gt; ruby-1.9
  Ruby 2.0                                rhc create-app &lt;app name&gt; ruby-2.0
  Tomcat 6 (JBoss EWS 1.0)                rhc create-app &lt;app name&gt; jbossews-1.0
  Tomcat 7 (JBoss EWS 2.0)                rhc create-app &lt;app name&gt; jbossews-2.0
  Vert.x 2.1                              rhc create-app &lt;app name&gt; jboss-vertx-2.1

  You are using 0 of 3 total gears
  The following gear sizes are available to you: small

Your client tools are now configured.
</pre>

<p>
<code>rhc create-app</code>的用法如下：
</p>
<pre>
$ rhc create-app --help
Usage: rhc app-create &lt;name&gt; &lt;cartridge&gt; [... &lt;cartridge&gt;] [... VARIABLE=VALUE] [-n namespace]

Create an application. Every OpenShift application must have one web cartridge which serves web requests, and can have a
number of other cartridges which provide capabilities like databases, scheduled jobs, or continuous integration.

You can see a list of all valid cartridge types by running 'rhc cartridge list'. OpenShift also supports downloading
cartridges - pass a URL in place of the cartridge name and we'll download and install that cartridge into your app.
Keep in mind that these cartridges receive no security updates.  Note that not all OpenShift servers allow downloaded
cartridges.

When your application is created, a URL combining the name of your app and the name of your domain will be registered in
DNS. A copy of the code for your application will be checked out locally into a folder with the same name as your
application.  Note that different types of applications may require different folder structures - check the README
provided with the cartridge if you have questions.

OpenShift runs the components of your application on small virtual servers called "gears".  Each account or plan is
limited to a number of gears which you can use across multiple applications.  Some accounts or plans provide access to
gears with more memory or more CPU.  Run 'rhc account' to see the number and sizes of gears available to you.  When
creating an application the --gear-size parameter may be specified to change the gears used.


Options
  -n, --namespace NAME      Namespace for the application
  -g, --gear-size SIZE      Gear size controls how much memory and CPU your cartridges can use.
  -s, --[no-]scaling        Enable scaling for the web cartridge.
  -r, --repo DIR            Path to the Git repository (defaults to ./$app_name)
  -e, --env VARIABLE=VALUE  Environment variable(s) to be set on this app, or path to a file containing environment
                            variables
  --from-app NAME           Create based on another application. All content and configurations will be copied from the
                            original app.
  --from-code URL           URL to a Git repository that will become the initial contents of the application
  --region REGION           The region where the application gears will be located
  --[no-]git                Skip creating the local Git repository.
  --[no-]dns                Skip waiting for the application DNS name to resolve. Must be used in combination with
                            --no-git
  --enable-jenkins [NAME]   Enable Jenkins builds for this application (will create a Jenkins application if not already

                            available). The default name will be 'jenkins' if not specified.
  -a, --app NAME            Name for your application
  -t, --type CARTRIDGE      The web framework this application should use

Global Options
  -l, --rhlogin LOGIN       OpenShift login
  -p, --password PASSWORD   OpenShift password
  --token TOKEN             An authorization token for accessing your account.
  --server HOSTNAME         An OpenShift server hostname (default: openshift.redhat.com)
  --timeout SECONDS         The timeout for operations

  See 'rhc help options' for a full list of global options.
</pre>
<p>
应用程序最后的域名格式为：<code>&lt;app name&gt;-&lt;namespace&gt;.rhcloud.com</code>
</p>

<h1 id="toc_3">部署Snova</h1>
<p>
首先到<a href="https://code.google.com/p/snova/downloads/list">这里</a>下载Snova服务器端（nodejs版）源码（笔者下的是snova-c4-nodejs-server-0.22.0.zip）和本地客户端程序。
</p>

<h2 id="toc_3.1">服务器端</h2>
<p>
运行以下命令（用你的应用程序名替代&lt;your app name&gt;），创建一个应用程序：
</p>
<pre>
$ rhc create-app &lt;your app name&gt; -t nodejs-0.10
</pre>

<p>
该命令成功运行完后，给出了该应用程序的URL，SSH to 和 Git remote 的信息，并在当前路径下生成一个名为&lt;your app name&gt;的目录，解压snova-c4-nodejs-server-0.22.0.zip并覆盖到这个目录，然后进入该目录，依次运行：
</p>
<pre>
$ git add .
$ git commit -m "First deployment "
$ git push
</pre>

<p>
若最后看到有如下信息：
</p>
<pre>
remote: Git Post-Receive Result: success
remote: Activation status: success
remote: Deployment completed with status: success
</pre>
<p>
则表示部署已经成功。
</p>

<h2 id="toc_3.2">修改客户端设置</h2>
<p>
修改gsnova.conf中C4部分，填入之前创建的域名（必须用https），重启gsnova生效
</p>
<pre>
[C4]
#Enable改为1，C4才能生效，默认为0关闭
Enable=1
#修改domain为前面创建的应用程序的域名, 可加多个域名
WorkerNode[0]=https://&lt;appname1&gt;-&lt;namespace&gt;.rhcloud.com
WorkerNode[1]=https://&lt;appname2&gt;-&lt;namespace&gt;.rhcloud.com
</pre>

<p>
修改gsnova.conf中SPAC下默认的Proxy实现为C4
</p>
<pre>
[SPAC]
Enable=1
#默认Proxy实现，初始为GAE
Default=C4
</pre>

<p>
启动GSnova，默认在127.0.0.1:48102上接受无spac支持的代理请求，在127.0.0.1:48100上接受有spac支持的代理请求。
</p>

          <div id="copy"></div>
<!-- JiaThis Button BEGIN -->
<div class="jiathis_style_32x32">
	<a class="jiathis_button_qzone"></a>
	<a class="jiathis_button_tsina"></a>
	<a class="jiathis_button_tqq"></a>
	<a class="jiathis_button_renren"></a>
	<a class="jiathis_button_t163"></a>
	<a class="jiathis_button_hi"></a>
	<a class="jiathis_button_fb"></a>
	<a class="jiathis_button_googleplus"></a>
	<a class="jiathis_button_twitter"></a>
	<a class="jiathis_button_linkedin"></a>
	<a class="jiathis_button_reddit"></a>
	<a href="http://www.jiathis.com/share?uid=1645446" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript">
var jiathis_config = {data_track_clickback:'true'};
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1340804108559251" charset="utf-8"></script>
<!-- JiaThis Button END -->
<!-- UJian Button BEGIN -->
	<div class="ujian-hook"></div>
	<script type="text/javascript" src="http://v1.ujian.cc/code/ujian.js?type=slide&"></script>
<!-- UJian Button END -->
<!-- UY BEGIN -->
<div id="uyan_frame"></div>
<script type="text/javascript" id="UYScript" src="http://v1.uyan.cc/js/iframe.js?UYUserId=1645446" async=""></script>
<!-- UY END -->
        </div> <!-- /.span9 -->
        <div class="span3">
<a class="twitter-timeline"  href="https://twitter.com/yysfirecn" data-widget-id="277690445834895360">@yysfirecn 的推文</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
<!-- UYAN HOT ARTICLE BEGIN -->
<div id="uyan_hotate_unit"></div>
<script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=1645446"></script> <!-- 如果已经过加载此行JS，即可不用重复加载 -->
<!-- UYAN HOT ARTICLE END -->
<!-- UYAN HOT COMMENT BEGIN -->
<div id="uyan_hotcmt_unit"></div>
<!-- UYAN HOT COMMENT END -->
<!-- UYAN NEW ARTICLE BEGIN -->
<div id="uyan_newate_unit"></div>
<!-- UYAN NEW ARTICLE END -->
<!-- UYAN NEW COMMENT BEGIN -->
<div id="uyan_newcmt_unit"></div>
<!-- UYAN NEW COMMENT END -->
        </div> <!-- /.span3 -->
      </div> <!-- /.row-fluid -->

      <footer class="footer">
      <p class="pull-right"><a href="#">回到顶部</a></p>
      <div id=license>
        <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/"><img alt="知识共享许可协议" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/3.0/cn/88x31.png" /></a>
        <p>除非另有声明，本站作品由<a href="https://twitter.com/yysfirecn">@幽谷奇峰</a>创作，<br />采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/">知识共享署名-非商业性使用-相同方式共享 3.0 中国大陆许可协议</a>进行许可。
        </p>
      </div> 
      <!--/#license-->
      <p>Generated by <a href="http://code.google.com/p/vimwiki/">Vimwiki</a>. Powered by <a href="https://github.com">GitHub Pages</a>.</p>
      </footer> <!-- /footer -->
    </div> <!-- /.container-fluid -->

    <!-- Placed at the end of the document so the pages load faster -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
    <script src="../bootstrap/js/bootstrap.min.js"></script>
    <script src="../google-code-prettify/prettify.js"></script>
    <script src="../myapp.js"></script>

  </body>
</html>

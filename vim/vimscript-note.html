<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Yysfire" />
        <meta name="copyright" content="Yysfire" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="Vim, Vimscript, vim, " />

<meta property="og:title" content="Vim 脚本学习笔记 "/>
<meta property="og:url" content="http://yysfire.github.io/vim/vimscript-note.html" />
<meta property="og:description" content="变量 Vimscript 变量范围 前缀 含义 g: varname 变量为全局变量 s: varname 变量的范围为当前的脚本文件 w: varname 变量的范围为当前的编辑器窗口 t: varname 变量的范围为当前的编辑器选项卡 b: varname 变量的范围为当前的编辑器缓冲区 l: varname 变量的范围为当前的函数 a: varname ..." />
<meta property="og:site_name" content="幽谷奇峰 | 燕雀鸣幽谷，鸿鹄掠奇峰" />
<meta property="og:article:author" content="Yysfire" />
<meta property="og:article:published_time" content="2012-12-04T11:20:41" />
<meta property="" content="2012-12-05T15:43:44" />
<meta name="twitter:title" content="Vim 脚本学习笔记 ">
<meta name="twitter:description" content="变量 Vimscript 变量范围 前缀 含义 g: varname 变量为全局变量 s: varname 变量的范围为当前的脚本文件 w: varname 变量的范围为当前的编辑器窗口 t: varname 变量的范围为当前的编辑器选项卡 b: varname 变量的范围为当前的编辑器缓冲区 l: varname 变量的范围为当前的函数 a: varname ...">

        <title>Vim 脚本学习笔记  · 幽谷奇峰 | 燕雀鸣幽谷，鸿鹄掠奇峰
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css" rel="stylesheet">
<link rel="stylesheet" href="http://yysfire.github.io/theme/css/style.min.css?7aeecf36">
        <link rel="shortcut icon" href="http://yysfire.github.io/theme/images/favicon.ico" type="image/x-icon" type="image/png" />
        <link rel="icon" href="http://yysfire.github.io/theme/images/apple-touch-icon-152x152.png" type="image/png" />
        <link rel="apple-touch-icon" href="http://yysfire.github.io/theme/images/apple-touch-icon.png"  type="image/png" />
        <link rel="apple-touch-icon" sizes="57x57" href="http://yysfire.github.io/theme/images/apple-touch-icon-57x57.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="72x72" href="http://yysfire.github.io/theme/images/apple-touch-icon-72x72.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="76x76" href="http://yysfire.github.io/theme/images/apple-touch-icon-76x76.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="114x114" href="http://yysfire.github.io/theme/images/apple-touch-icon-114x114.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="120x120" href="http://yysfire.github.io/theme/images/apple-touch-icon-120x120.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="144x144" href="http://yysfire.github.io/theme/images/apple-touch-icon-144x144.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="152x152" href="http://yysfire.github.io/theme/images/apple-touch-icon-152x152.png" type="image/png" />
        <link href="http://yysfire.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="幽谷奇峰 | 燕雀鸣幽谷，鸿鹄掠奇峰 - Full Atom Feed" />
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="http://yysfire.github.io/"><span class=site-name>幽谷奇峰 | 燕雀鸣幽谷，鸿鹄掠奇峰</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href="http://yysfire.github.io">Home</a></li>
                            <li ><a href="http://yysfire.github.io/categories.html">Categories</a></li>
                            <li ><a href="http://yysfire.github.io/tags.html">Tags</a></li>
                            <li ><a href="http://yysfire.github.io/archives.html">Archives</a></li>
                            <li><form class="navbar-search" action="http://yysfire.github.io/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article>
<div class="row-fluid">
    <header class="page-header span10 offset2">
    <h1><a href="http://yysfire.github.io/vim/vimscript-note.html"> Vim 脚本学习笔记  </a></h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div class="toc">
<ul>
<li><a href="#_1">变量</a></li>
<li><a href="#exists">exists()函数</a></li>
<li><a href="#vimscript">Vimscript 中的真和假</a></li>
<li><a href="#_2">字符串常量</a></li>
<li><a href="#_3">表达式</a></li>
<li><a href="#_4">逻辑操作</a></li>
<li><a href="#_5">字符串比较</a></li>
<li><a href="#_6">命令的续行与拼接</a></li>
<li><a href="#_7">算术说明</a></li>
<li><a href="#execute-normal">execute 与 normal 命令</a></li>
<li><a href="#_8">函数</a><ul>
<li><a href="#_9">范围的使用</a></li>
<li><a href="#_10">可变参数</a></li>
<li><a href="#_11">函数引用</a></li>
<li><a href="#_12">函数封装</a></li>
</ul>
</li>
<li><a href="#_13">编写插件</a><ul>
<li><a href="#_14">用户命令</a></li>
</ul>
</li>
</ul>
</div>
        </nav>
    </div>
    <div class="span8 article-content">

            
            
<h2 id="_1">变量</h2>
<p>Vimscript 变量范围</p>
<table>
<thead>
<tr>
<th>前缀</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>g: varname</td>
<td>变量为全局变量</td>
</tr>
<tr>
<td>s: varname</td>
<td>变量的范围为当前的脚本文件</td>
</tr>
<tr>
<td>w: varname</td>
<td>变量的范围为当前的编辑器窗口</td>
</tr>
<tr>
<td>t: varname</td>
<td>变量的范围为当前的编辑器选项卡</td>
</tr>
<tr>
<td>b: varname</td>
<td>变量的范围为当前的编辑器缓冲区</td>
</tr>
<tr>
<td>l: varname</td>
<td>变量的范围为当前的函数</td>
</tr>
<tr>
<td>a: varname</td>
<td>变量是当前函数的一个参数</td>
</tr>
<tr>
<td>v: varname</td>
<td>变量是 Vim 的预定义变量</td>
</tr>
</tbody>
</table>
<p>变量采用 ":let" 命令赋值，同时也占用内存空间。为了删除一个变量可以使用 ":unlet" 命令。例:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">:</span><span class="n">unlet</span> <span class="n">s</span><span class="o">:</span><span class="n">count</span>
</pre></div>
</td></tr></table>
<p>这将删除 "s:count" 这个脚本局部变量并释放其占用的内存。如果你并不确定这个变量是否存在，但并不希望系统在它不存在时报错，可以在命令后添加 <code>!</code>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">:</span><span class="n">unlet</span><span class="o">!</span> <span class="n">s</span><span class="o">:</span><span class="n">count</span>
</pre></div>
</td></tr></table>
<p>当一个脚本结束时，它使用的局部变量不会自动被删除。下一次脚本被执行时，旧的变量值仍可被使用。</p>
<h2 id="exists"><code>exists()</code>函数</h2>
<p>"exists()" 函数检查一个变量是否已经被定义过了。它的参数是你想检查的变量的名字。而不是变量本身！如果你这样做:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">:</span><span class="k">if</span> <span class="o">!</span><span class="n">exists</span><span class="p">(</span><span class="n">s</span><span class="o">:</span><span class="n">call_count</span><span class="p">)</span>
</pre></div>
</td></tr></table>
<p>那么变量 s:call_count 的值将被用来做检测。你不会得到想的结果。</p>
<h2 id="vimscript">Vimscript 中的真和假</h2>
<p>Vim 把任何非零的值当作真。零代表假。</p>
<p>如果期待数值类型，Vim 自动把字符串转换为数值。如果使用不以数位开始的字符串，返回的数值为零。所以小心这种代码:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">:</span><span class="k">if</span> <span class="s">"true"</span>
</pre></div>
</td></tr></table>
<p>这里 "true" 会被解读为零，也就是假值！</p>
<h2 id="_2">字符串常量</h2>
<p>你需要使用字符串常量来为字符串变量赋值。字符串常量有两种。第一种是由双引号括起来的，里面可以包含转义序列，例如，<code>\n</code>用于换行，<code>\"</code>用于双引号，<code>\u263A</code>用于 Unicode 笑脸标志，<code>\&lt;ESC&gt;</code>用于 Escape 键。</p>
<p>如果你不想使用反斜杠，也可以用单引号括起字符串。所有的字符在单引号内都保持其本来面目，只有单引号本身例外: 输入两个你会得到一个单引号。 因为反斜杠在其中也被作为其本身来对待，你无法使用它来改变其后的字符的意义。</p>
<h2 id="_3">表达式</h2>
<p>已经提到的那些数值，字符串常量和变量都属于表达式。因此任何可以使用表达式的地方，数值，字符串变量和常量都可以使用。其它基本的表达式有:</p>
<table>
<thead>
<tr>
<th>表达式</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>$NAME</td>
<td>环境变量</td>
</tr>
<tr>
<td>&amp;name</td>
<td>选项</td>
</tr>
<tr>
<td>@r</td>
<td>寄存器</td>
</tr>
</tbody>
</table>
<p>一般的，当 ":echo" 命令遇到多个参数时，会在它们之间加入空格。</p>
<h2 id="_4">逻辑操作</h2>
<p>对数值和字符串都可以做逻辑操作。两个字符串的算术差被用来比较它们的值。这个结果是通过字节值来计算的，对于某些语言，这样做的结果未必正确。</p>
<p>在比较一个字符串和一个数值时，该字符串将先被转换成一个数值。这容易出错，因为当一个字符串看起来不像数值时，它会被当作 0 对待。</p>
<h2 id="_5">字符串比较</h2>
<p>对于字符串来说还有两种操作:</p>
<table>
<thead>
<tr>
<th>操作</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>a =~ b</code></td>
<td>匹配</td>
</tr>
<tr>
<td><code>a !~ b</code></td>
<td>不匹配</td>
</tr>
</tbody>
</table>
<p>左边的 "a" 被当作一个字符串。右边的 "b" 被当作一个匹配模式，正如做查找操作一样。</p>
<p>在做字符串比较时用到 'ignorecase' 选项。如果你不希望使用该选项，可以在比较时加上 "#" 或 "?"。"#" 表示大小写敏感；"?" 表示忽略大小写。因此 "==?" 比较两字符串是否相等，不计大小写。"!~#" 检查一个模式是否被匹配，同时也考虑大小写。</p>
<p>":sleep" 命令使 Vim 小憩一下。"50m" 表示休息 50 毫秒。再举一个例子，":sleep 4" 休息 4 秒。</p>
<h2 id="_6">命令的续行与拼接</h2>
<p>Vimscript 中一条较长的命令可以分割成多行来写，但必须用反斜杠来作为续行符，反斜杠作为续行符一般写在下一行的开头。</p>
<p>相反地，多条命令也可以通过 '|' 字符拼接到一行中来。</p>
<h2 id="_7">算术说明</h2>
<p>在使用算术表达式时，还需要记住一点，在版本 7.2 之前，Vim 只支持整数运算。早期版本中的一个普遍错误是编写类似下面的代码：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span class="s">"Step through each file...</span>
<span class="k">for</span> <span class="n">filenum</span> <span class="n">in</span> <span class="n">range</span><span class="p">(</span><span class="n">filecount</span><span class="p">)</span>
    <span class="s">" Show progress...</span>
    <span class="n">echo</span> <span class="p">(</span><span class="n">filenum</span> <span class="o">/</span> <span class="n">filecount</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="p">.</span> <span class="err">'</span><span class="o">%</span> <span class="n">done</span><span class="err">'</span>
    <span class="s">" Make progress...</span>
   <span class="n">call</span> <span class="n">process_file</span><span class="p">(</span><span class="n">filenum</span><span class="p">)</span>
<span class="n">endfor</span>
</pre></div>
</td></tr></table>
<p>由于 filenum 始终小于 filecount，整数除法 filenum/filecount 将始终生成 0，因此每次迭代循环都将生成：<code>Now 0% done</code></p>
<p>即使对于版本 7.2，如果其中一个运算对象被明确声明为浮点类型，那么 Vim 只支持浮点算术：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">let</span> <span class="n">filecount</span> <span class="o">=</span> <span class="mi">234</span>
<span class="n">echo</span> <span class="n">filecount</span><span class="o">/</span><span class="mi">100</span>   <span class="o">|</span><span class="s">" echoes 2</span>
<span class="n">echo</span> <span class="n">filecount</span><span class="o">/</span><span class="mf">100.0</span> <span class="o">|</span><span class="s">" echoes 2.34</span>
</pre></div>
</td></tr></table>
<p>到目前为止，脚本内的语句都是由 Vim 直接运行的。用 ":execute" 命令可以执行一个表达式的结果。这是一个创建并执行命令的非常有效的方法。</p>
<h2 id="execute-normal"><code>execute</code> 与 <code>normal</code> 命令</h2>
<p>":execute" 命令只能用来执行冒号命令。":normal" 命令可以用来执行普通模式命令。然而，它的参数只能是按表面意义解释的命令字符，不能是表达式。例如:为了使 ":normal" 命令也可以带表达式，可以把 ":execute" 与其连起来使用。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">:</span><span class="n">execute</span> <span class="s">"normal "</span> <span class="p">.</span> <span class="n">normal_commands</span>
</pre></div>
</td></tr></table>
<p>变量 "normal_commands" 必须包含要执行的普通模式命令。</p>
<p>必须确保 ":normal" 的参数是一个完整的命令。否则，Vim 碰到参数的结尾就会中止其运行。例如，如果你开始了插入模式，你必须也退出插入模式。</p>
<h2 id="_8">函数</h2>
<p>Vim 允许你定义自己的函数。基本的函数声明如下:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">:</span><span class="kd">function</span> <span class="p">{</span><span class="nx">name</span><span class="p">}({</span><span class="nx">var1</span><span class="p">},</span> <span class="p">{</span><span class="nx">var2</span><span class="p">},</span> <span class="p">...)</span>
<span class="o">:</span>  <span class="p">{</span><span class="nx">body</span><span class="p">}</span>
<span class="o">:</span><span class="nx">endfunction</span>
</pre></div>
</td></tr></table>
<p><strong>注意: 函数名必须以大写字母开始。</strong></p>
<p>当一个函数执行到 ":endfunction" 或 ":return" 语句没有带参数时，该函数返回零。</p>
<p>如果要重定义一个已经存在的函数，在 "function" 命令后加上<code>!</code>.</p>
<h3 id="_9">范围的使用</h3>
<p>":call" 命令可以带一个行表示的范围。这可以分成两种情况。当一个函数定义时给出了 "range" 关键字时，表示它会自行处理该范围。</p>
<p>Vim 在调用这样一个函数时给它传递两个参数: "a:firstline" 和 "a:lastline"，用来表示该范围所包括的第一行和最后一行。例如:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">:</span><span class="kd">function</span> <span class="nx">Count_words</span><span class="p">()</span> <span class="nx">range</span>
<span class="o">:</span>  <span class="kd">let</span> <span class="nx">lnum</span> <span class="o">=</span> <span class="nx">a</span><span class="o">:</span><span class="nx">firstline</span>
<span class="o">:</span>  <span class="kd">let</span> <span class="nx">n</span> <span class="o">=</span> <span class="mi">0</span>
<span class="o">:</span>  <span class="k">while</span> <span class="nx">lnum</span> <span class="o">&lt;=</span> <span class="nx">a</span><span class="o">:</span><span class="nx">lastline</span>
<span class="o">:</span>    <span class="kd">let</span> <span class="nx">n</span> <span class="o">=</span> <span class="nx">n</span> <span class="o">+</span> <span class="nx">len</span><span class="p">(</span><span class="nx">split</span><span class="p">(</span><span class="nx">getline</span><span class="p">(</span><span class="nx">lnum</span><span class="p">)))</span>
<span class="o">:</span>    <span class="kd">let</span> <span class="nx">lnum</span> <span class="o">=</span> <span class="nx">lnum</span> <span class="o">+</span> <span class="mi">1</span>
<span class="o">:</span>  <span class="nx">endwhile</span>
<span class="o">:</span>  <span class="nx">echo</span> <span class="s2">"found "</span> <span class="p">.</span> <span class="nx">n</span> <span class="p">.</span> <span class="s2">" words"</span>
<span class="o">:</span><span class="nx">endfunction</span>
</pre></div>
</td></tr></table>
<p>你可以这样调用上面的函数:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">:</span><span class="mi">10</span><span class="p">,</span><span class="mi">30</span><span class="n">call</span> <span class="n">Count_words</span><span class="p">()</span>
</pre></div>
</td></tr></table>
<p>这个函数将被调用一次并显示字数。</p>
<p>另一种使用范围的方式是在定义函数时不给出 "range" 关键字。Vim 将把光标移动到范围内的每一行，并分别对该行调用此函数。例如:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">:</span><span class="kd">function</span>  <span class="nb">Number</span><span class="p">()</span>
<span class="o">:</span>  <span class="nx">echo</span> <span class="s2">"line "</span> <span class="p">.</span> <span class="nx">line</span><span class="p">(</span><span class="s2">"."</span><span class="p">)</span> <span class="p">.</span> <span class="s2">" contains: "</span> <span class="p">.</span> <span class="nx">getline</span><span class="p">(</span><span class="s2">"."</span><span class="p">)</span>
<span class="o">:</span><span class="nx">endfunction</span>
</pre></div>
</td></tr></table>
<p>如果你用下面的方式调用该函数:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">:</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="n">call</span> <span class="n">Number</span><span class="p">()</span>
</pre></div>
</td></tr></table>
<p>它将被执行六次。</p>
<h3 id="_10">可变参数</h3>
<p>Vim 允许你定义参数个数可变的函数。下面的例子给出一个至少有一个参数 (start)，但
可以多达 20 个附加参数的函数:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">:</span><span class="kd">function</span> <span class="nx">Show</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="p">...)</span>
</pre></div>
</td></tr></table>
<p>变量 "a:1" 表示第一个可选的参数，"a:2" 表示第二个，如此类推。变量 "a:0" 表示
这些参数的个数。例如:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">:</span><span class="kd">function</span> <span class="nx">Show</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="p">...)</span>
<span class="o">:</span>  <span class="nx">echohl</span> <span class="nx">Title</span>
<span class="o">:</span>  <span class="nx">echo</span> <span class="s2">"Show is "</span> <span class="p">.</span> <span class="nx">a</span><span class="o">:</span><span class="nx">start</span>
<span class="o">:</span>  <span class="nx">echohl</span> <span class="nx">None</span>
<span class="o">:</span>  <span class="kd">let</span> <span class="nx">index</span> <span class="o">=</span> <span class="mi">1</span>
<span class="o">:</span>  <span class="k">while</span> <span class="nx">index</span> <span class="o">&lt;=</span> <span class="nx">a</span><span class="o">:</span><span class="mi">0</span>
<span class="o">:</span>    <span class="nx">echo</span> <span class="s2">"  Arg "</span> <span class="p">.</span> <span class="nx">index</span> <span class="p">.</span> <span class="s2">" is "</span> <span class="p">.</span> <span class="nx">a</span><span class="o">:</span><span class="p">{</span><span class="nx">index</span><span class="p">}</span>
<span class="o">:</span>    <span class="kd">let</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">index</span> <span class="o">+</span> <span class="mi">1</span>
<span class="o">:</span>  <span class="nx">endwhile</span>
<span class="o">:</span>  <span class="nx">echo</span> <span class="s2">""</span>
<span class="o">:</span><span class="nx">endfunction</span>
</pre></div>
</td></tr></table>
<p>上例中 ":echohl" 命令被用来给出接下来的 ":echo" 命令如何高亮输出。":echohl None" 终止高亮。":echon" 命令除了不输出换行符外，和 ":echo" 一样。</p>
<p>你可以用 a:000 变量，它是所有 "..." 参数的列表。详情见 <code>help: a:000</code> 。</p>
<h3 id="_11">函数引用</h3>
<p>有时使变量指向一个或另一个函数可能有用。要这么做，用 function() 函数。它把函数名转换为引用。</p>
<p><strong>注意 保存函数引用的变量名必须用大写字母开头，不然和内建函数的名字会引起混淆。</strong></p>
<p>调用变量指向的函数可以用 call() 函数。它的第一个参数是函数引用，第二个参数是参数构成的列表。</p>
<p>字典项目通常可以用方括号里的索引得到:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">:</span><span class="n">echo</span> <span class="n">uk2nl</span><span class="p">[</span><span class="err">'</span><span class="n">one</span><span class="err">'</span><span class="p">]</span>
<span class="n">een</span> <span class="o">~</span>
</pre></div>
</td></tr></table>
<p>完成同样操作且无需那么多标点符号的方法:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">:</span><span class="n">echo</span> <span class="n">uk2nl</span><span class="p">.</span><span class="n">one</span>
<span class="n">een</span> <span class="o">~</span>
</pre></div>
</td></tr></table>
<p>这只能用于由 ASCII 字母、数位和下划线组成的键。此方式也可以用于赋值。</p>
<h3 id="_12">函数封装</h3>
<p>为了避免你的函数名同其它的函数名发生冲突，使用这样的方法:
- 在函数名前加上独特的字符串。我通常使用一个缩写。例如，"OW_" 被用在 option
  window 函数上。
- 将你的函数定义放在一个文件内。设置一个全局变量用来表示这些函数是否已经被加载
  了。当再次 source 这个文件的时候，先将这些函数卸载。</p>
<h2 id="_13">编写插件</h2>
<p>首先你得给你的插件起个名字。这个名字应该很清楚地表示该插件的用途。同时应该避免同别的插件用同样的名字而用途不同。请将插件名限制在 8 个字符以内，这样可以使得该插件在老的 Windows 系统也能使用。</p>
<p><code>&lt;SID&gt;</code> 和 <code>&lt;Plug&gt;</code> 都是用来避免映射的键序列和那些仅仅用于其它映射的映射起冲突。</p>
<p>注意 <code>&lt;SID&gt;</code> 和 <code>&lt;Plug&gt;</code> 的区别:</p>
<table>
<thead>
<tr>
<th>标志</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;Plug&gt;</code></td>
<td>在脚本外部是可见的。它被用来定义那些用户可能定义映射的映射。<code>&lt;Plug&gt;</code> 是</td>
</tr>
<tr>
<td>\/</td>
<td>无法用键盘输入的特殊代码。</td>
</tr>
<tr>
<td>\/</td>
<td>使用结构：<code>&lt;Plug&gt;</code> 脚本名 映射名，可以使得其它插件使用同样次序的字符来定</td>
</tr>
<tr>
<td>\/</td>
<td>义映射的几率变得非常小。在我们上面的例子中，脚本名是 "Typecorr"，映射</td>
</tr>
<tr>
<td>\/</td>
<td>名是 "Add"。结果是 <code>&lt;Plug&gt;TypecorrAdd</code>。只有脚本名和映射名的第一个字</td>
</tr>
<tr>
<td>\/</td>
<td>符是大写的，所以我们可以清楚地看到映射名从什么地方开始。</td>
</tr>
<tr>
<td><code>&lt;SID&gt;</code></td>
<td>是脚本的 ID，用来唯一的代表一个脚本。Vim 在内部将 <code>&lt;SID&gt;</code> 翻译为</td>
</tr>
<tr>
<td>\/</td>
<td><code>&lt;SNR&gt;123_</code>，其中 "123" 可以是任何数字。这样一个函数 <code>&lt;SID&gt;Add()</code> 可能</td>
</tr>
<tr>
<td>\/</td>
<td>在一个脚本中被命名为 <code>&lt;SNR&gt;11_Add()</code>，而在另一个脚本中被命名为</td>
</tr>
<tr>
<td>\/</td>
<td><code>&lt;SNR&gt;22_Add()</code>。如果你用 <code>:function</code> 命令来获得系统中的函数列表你就可</td>
</tr>
<tr>
<td>\/</td>
<td>以看到了。映射中对 <code>&lt;SID&gt;</code> 的翻译是完全一样的。这样你才有可能通过一个映</td>
</tr>
<tr>
<td>\/</td>
<td>射来调用某个脚本中的局部函数。</td>
</tr>
</tbody>
</table>
<p>关于插件的小结:</p>
<table>
<thead>
<tr>
<th>语句</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>s:name</code></td>
<td>脚本的局部变量。</td>
</tr>
<tr>
<td><code>&lt;SID&gt;</code></td>
<td>脚本 ID，用于局部于脚本的映射和函数。</td>
</tr>
<tr>
<td><code>hasmapto()</code></td>
<td>用来检测插件定义的映射是否已经存在的函数。</td>
</tr>
<tr>
<td><code>&lt;Leader&gt;</code></td>
<td>"mapleader" 的值。用户可以通过该变量定义插件所定义映射</td>
</tr>
<tr>
<td><code>:map &lt;unique&gt;</code></td>
<td>如果一个映射已经存在的话，给出警告信息。</td>
</tr>
<tr>
<td><code>:noremap &lt;script&gt;</code></td>
<td>在映射右边仅执行脚本的局部映射，而不检查全局映射。</td>
</tr>
<tr>
<td><code>exists(":Cmd")</code></td>
<td>检查一个用户命令是否存在。</td>
</tr>
</tbody>
</table>
<h3 id="_14">用户命令</h3>
<p>在使用 <code>:command</code> 命令时，如果加上 "-buffer" 开关，就可以为某一类型的文件加入一个用户命令，而该命令又只能用于一个缓冲区。例:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">:</span><span class="n">command</span> <span class="o">-</span><span class="n">buffer</span>  <span class="n">Make</span>  <span class="n">make</span> <span class="o">%:</span><span class="n">r</span><span class="p">.</span><span class="n">s</span>
</pre></div>
</td></tr></table>
<p>以下是有关文件类型插件一些特殊环节：</p>
<table>
<thead>
<tr>
<th>语句</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;LocalLeader&gt;</code></td>
<td>"maplocalleader" 的值，用户可以通过它来自定义文件类型插件中映射的起始字符。</td>
</tr>
<tr>
<td><code>:map &lt;buffer&gt;</code></td>
<td>定义一个仅对缓冲区有效的局部映射。</td>
</tr>
<tr>
<td><code>:noremap &lt;script&gt;</code></td>
<td>仅重映射脚本中以 <code>&lt;SID&gt;</code> 开始的映射。</td>
</tr>
<tr>
<td><code>:setlocal</code></td>
<td>设定仅对当前缓冲区有效的选项。</td>
</tr>
<tr>
<td><code>:command -buffer</code></td>
<td>定义一个仅对缓冲区有效的局部命令。</td>
</tr>
<tr>
<td><code>exists("*s:Func")</code></td>
<td>查看是否已经定义了某个函数。</td>
</tr>
</tbody>
</table>
<p>参阅所有插件的特殊环节 <code>:help plugin-special</code>。</p>
            
            
            <hr/>
<section>
    <h2>Related Posts</h2>
<ul class="related-posts-list">
<li><a href="http://yysfire.github.io/vim/vim-command-note.html" title="Vim命令拾遗">Vim命令拾遗</a></li>
<li><a href="http://yysfire.github.io/vim/vimwiki-syntaxhighlighter.html" title="在 VimWiki 中使用 SyntaxHighlighter 实现代码语法高亮">在 VimWiki 中使用 SyntaxHighlighter 实现代码语法高亮</a></li>
<li><a href="http://yysfire.github.io/vim/make-vim-to-use-solarized-colorscheme-in-gnome-terminal.html" title="让Vim在Gnome-terminal下使用Solarized Colorscheme">让Vim在Gnome-terminal下使用Solarized Colorscheme</a></li>
</ul>
<hr />
</section>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="previous-article">« <a href="http://yysfire.github.io/linux/how-to-check-linux-terminal-whether-support-256-colors.html" title="Previous: 如何查看Linux终端是否支持256色">如何查看Linux终端是否支持256色</a></li>
                <li class="next-article"><a href="http://yysfire.github.io/vim/make-vim-to-use-solarized-colorscheme-in-gnome-terminal.html" title="Next: 让Vim在Gnome-terminal下使用Solarized Colorscheme">让Vim在Gnome-terminal下使用Solarized Colorscheme</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2012-12-04T11:20:41">十二月 4, 2012</time>

<h4>Last Updated</h4>
<time datetime="2012-12-05T15:43:44">十二月 5, 2012</time>

            <h4>Category</h4>
            <a class="category-link" href="http://yysfire.github.io/categories.html#vim-ref">vim</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="http://yysfire.github.io/tags.html#vim-ref">Vim
                    <span>4</span>
</a></li>
                <li><a href="http://yysfire.github.io/tags.html#vimscript-ref">Vimscript
                    <span>1</span>
</a></li>
            </ul>
<h4>Contact</h4>
    <a href="https://twitter.com/yysfirecn" title="My twitter Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-twitter sidebar-social-links"></i></a>
    <a href="https://www.facebook.com/yysfire" title="My facebook Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-facebook sidebar-social-links"></i></a>
    <a href="https://github.com/yysfire" title="My github Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-github sidebar-social-links"></i></a>
        </div>
        </section>
</div>
</article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
        <div id="push"></div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-license"> 除非另有声明，本站作品由<a href="https://twitter.com/yysfirecn"> Yysfire </a>创作，采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/">知识共享署名-非商业性使用-相同方式共享 3.0 中国大陆许可协议</a>进行许可。</li>
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>            <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    
    </body>
    <!-- Theme: Elegant built for Pelican
    License : http://oncrashreboot.com/pelican-elegant -->
</html>
<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <title>Ubuntu12.04 x64系统手动编译安装NVIDIA官方驱动</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="幽谷奇峰">

    <!-- Le styles -->
    <link href="../bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>
    <link href="../bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet">
    <link href="../google-code-prettify/sons-of-obsidian.css" rel="stylesheet">
    <link href="../mystyle.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="../ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../ico/apple-touch-icon-57-precomposed.png">
  </head>
  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="../index.html">幽谷奇峰</a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="../index.html">主页</a></li>
              <li class="active"><a href="../linux/index.html">Linux</a></li>
              <li><a href="../vim/index.html">Vim</a></li>
              <li><a href="../webdesign/index.html">前端设计</a></li>
              <li><a href="../c_cpp/index.html">C和C++</a></li>
              <li><a href="../python/index.html">Python</a></li>
              <li class="divider-vertical"></li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">联系我 <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="https://twitter.com/yysfirecn">@推一推我</a></li>
                  <li><a href="https://www.facebook.com/yaley2">君要你死</a></li>
                  <li><a href="../about.html">给我写信</a></li>
                </ul> <!--/.dropdown-menu -->
              </li> <!--/.dropdown -->
            </ul> <!--/.nav -->
          </div> <!--/.nav-collapse -->

          <div class="pull-right">
            <form class="navbar-search" action="../search.html">
              <!--<div class="input-append">-->
                <input type="text" name="q" class="search-query input-medium" placeholder="搜索">
                <button type="submit" class="icon nav-search"><i class="icon-search icon-white"></i></button>
              <!--</div>-->
            </form>
          </div>

        </div> <!-- /.container -->
      </div> <!--/.navbar-inner-->
    </div> <!--/.navbar-->
    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span9">
          <ul class="breadcrumb">
            <li>
            <a href="../index.html">首页</a> <span class="divider">/</span>
            </li>
            <li>
            <a href="../linux/index.html">Linux</a> <span class="divider">/</span>
            </li>
            <li class="active">你的位置</li>
          </ul>
          
<div class="toc">
<ul>
<li><a href="#toc_1">Ubuntu12.04 x64系统手动编译安装NVIDIA官方驱动</a>
<ul>
<li><a href="#toc_1.1">手动编译安装NVIDIA官方驱动</a>
<li><a href="#toc_1.2">内核升级后自动安装NVIDIA驱动</a>
<li><a href="#toc_1.3">使用开源nouveau驱动</a>
<li><a href="#toc_1.4">参考资料</a>
</ul>
</ul>
</div>
<hr />
<ul>
<li>
Last Modified: 2012-10-07 15:32:19

<li>
First Created: 2012-09-10 14:05:04

</ul>
<hr />
<h1 id="toc_1">Ubuntu12.04 x64系统手动编译安装NVIDIA官方驱动</h1>

<p>
我的系统环境是：Ubuntu 12.04 64位版，显卡为NVIDIA Geforce 7300 GT。
</p>

<p>
首先，请确认linux-restricted-modules和linux-restricted-modules-common这两个模块没被安装，如果安装过请卸载掉。
</p>

<h2 id="toc_1.1">手动编译安装NVIDIA官方驱动</h2>

<p>
1) 下载适合自己显卡的官方驱动
</p>

<p>
Nvidia中文官网是 <a href="http://www.nvidia.cn/page/home.html">http://www.nvidia.cn/page/home.html</a>
</p>

<p>
下载自己显卡对应的驱动，放到/home/用户名/目录下，我下载的是 NVIDIA-Linux-x86_64-304.43.run
</p>

<p>
2) 卸载之前安装过的NVIDIA受限驱动包
</p>
<pre class="brush:bash">
sudo apt-get purge nvidia-*
sudo apt-get autoremove
</pre>

<p>
3) 安装编译依赖
</p>
<pre class="brush:bash">
sudo apt-get install build-essential pkg-config xserver-xorg-dev linux-headers-`uname -r`
</pre>

<p>
4) 屏蔽掉开源驱动
</p>

<p>
编辑blacklist.conf文件，
</p>
<pre class="brush:bash">
sudo gedit /etc/modprobe.d/blacklist.conf
</pre>

<p>
在文件尾部添加以下几行：
</p>
<pre class="brush:bash">
blacklist nouveau
blacklist vga16fb
blacklist rivafb
blacklist nvidiafb
blacklist rivatv
</pre>

<p>
5) 重启电脑
</p>
<pre class="brush:bash">
sudo reboot
</pre>

<p>
6) 关闭图形环境
</p>

<p>
进入登录界面后，按"Ctrl-Alt-F1"，进入控制台，运行以下命令关闭图形环境
</p>
<pre class="brush:bash">
sudo /etc/init.d/kdm stop  #适用于Kubuntu
sudo /etc/init.d/gdm stop  #适用于Ubuntu
sudo stop lightdm          #适用于Ubuntu11.10 and later
</pre>

<p>
7) 开始安装
</p>

<p>
进入之前下载的驱动安装文件所在目录，运行：
</p>
<pre class="brush:bash">
sudo sh NVIDIA-Linux-x86_64-304.43.run
</pre>
<p>
安装过程中:
</p>

<p>
如果提示有旧驱动，询问是否删除旧驱动，选Yes；
</p>

<p>
如果提示缺少某某模块（modules），询问是否上网下载，选No；
</p>

<p>
如果提示编译模块，询问是否进行编译，选Ok；
</p>

<p>
如果提示将要修改Xorg.conf，询问是否允许，选Yes； 
</p>

<p>
如果出现以下错误：
</p>
<pre class="brush:bash">
ERROR: Unable to load the kernel module 'nvidia.ko'.  This happens most
       frequently when this kernel module was built against the wrong or
       improperly configured kernel sources, with a version of gcc that differs
       from the one used to build the target kernel, or if a driver such as
       rivafb/nvidiafb is present and prevents the NVIDIA kernel module from
       obtaining ownership of the NVIDIA graphics device(s), or NVIDIA GPU
       installed in this system is not supported by this NVIDIA Linux graphics
       driver release.
</pre>
<p>
就试试以下命令：
</p>
<pre class="brush:bash">
sudo sh NVIDIA-Linux-x86_64-304.43.run -k $(uname -r)
</pre>

<p>
8) 重启图形环境
</p>
<pre class="brush:bash">
sudo /etc/init.d/kdm restart    #适用于Kubuntu
sudo /etc/init.d/gdm restart    #适用于Ubuntu
sudo start lightdm 		#适用于Ubuntu11.10 and later
</pre>
<hr />
<h2 id="toc_1.2">内核升级后自动安装NVIDIA驱动</h2>

<p>
这样手动安装的NVIDIA官方驱动，以后系统内核每更新一次，都要再重新安装一次。为了省去这个麻烦，我们可以做到让内核升级后自动安装NVIDIA驱动。
</p>

<p>
首先确定驱动正常工作后, 必需先重启一次。
</p>

<p>
然后，把你使用的驱动安装文件放到/home/username下，并生成链接。例如：
</p>
<pre class="brush:bash">
sudo mv NVIDIA-Linux-x86_64-304.43.run /home/username
sudo ln -s /home/username/NVIDIA-Linux-x86_64-304.43.run /home/username/nvidia-driver
</pre>

<p>
这样做的目的是当你更换所用的驱动时，只需要删除原来的链接后再指定新的链接即可，不需要改变我们将使用的脚本。
</p>

<p>
将以下内容写入自动安装NVIDIA驱动的脚本update-nvidia:
</p>
<pre class="brush:bash">
#!/bin/bash
# Set this to the exact path of the nvidia driver you plan to use
# It is recommended to use a symlink here so that this script doesn't
# have to be modified when you change driver versions.
DRIVER=/home/username/nvidia-driver

# Build new driver if it doesn't exist
if [ -e /lib/modules/$1/kernel/drivers/video/nvidia.ko ] ; then
    echo "NVIDIA driver already exists for this kernel." &gt;&amp;2
else
    echo "Building NVIDIA driver for kernel $1" &gt;&amp;2
    sh $DRIVER -K -k $1 -s -n 2&gt;1 &gt; /dev/null
    if [ -e /lib/modules/$1/kernel/drivers/video/nvidia.ko ] ; then
        echo "   SUCCESS: Driver installed for kernel $1" &gt;&amp;2
    else
        echo "   FAILURE: See /var/log/nvidia-installer.log" &gt;&amp;2
    fi
fi

exit 0
</pre>

<p>
基本上，原理是检查新安装的内核是否安装了正确的NVIDIA驱动，如果没有，脚本将自动为新内核安装驱动模块。
</p>

<p>
安装该脚本：
</p>
<pre class="brush:bash">
sudo mkdir -p /etc/kernel/postinst.d
sudo install update-nvidia /etc/kernel/postinst.d
</pre>

<p>
这样，以后内核升级后就会自动安装NVIDIA驱动, 不用再每更新一次内核就重装一次驱动。
<hr />
</p>
<h2 id="toc_1.3">使用开源nouveau驱动</h2>
<p>
出于某些原因，你可能想用回系统安装之初的开源驱动。
首先，确保开源驱动没被卸载，否则，运行以下命令重新安装。
</p>
<pre class="brush:bash">
sudo aptitude install xserver-xorg-video-nouveau
</pre>

<p>
其次，编辑/etc/modprobe.d/blacklist.conf，去掉屏蔽nouveau的行
</p>

<p>
然后，就有两种方法了：
</p>

<p>
1.1 不使用xorg.conf
</p>
<pre class="brush:bash">
sudo mv /etc/X11/xorg.conf /etc/X11/xorg.conf.bak
</pre>

<p>
1.2 使用xorg.conf
</p>

<p>
由于官方驱动和nouveau驱动的xorg.conf现在是兼容的, 只需把xorg.conf中的
</p>
<pre class="brush:bash">
Driver         "nvidia"
</pre>
 
<p>
改成：
</p>
<pre class="brush:bash">
Driver        "nouveau"
</pre>

<p>
例如：
</p>
<pre class="brush:bash">
Section "Device"
    Identifier     "Device0"
#   Driver         "nvidia"
    Driver         "nouveau"
    VendorName     "NVIDIA Corporation"
EndSection
</pre>

<h2 id="toc_1.4">参考资料</h2>
<ol>
<li>
<a href="http://forum.ubuntu.org.cn/viewtopic.php?f=42&amp;t=141431">http://forum.ubuntu.org.cn/viewtopic.php?f=42&amp;t=141431</a>

</ol>

<hr />
<p>
Tags: Ubuntu, NVIDIA, Linux
</p>

          <div id="copy"></div>
<!-- JiaThis Button BEGIN -->
<div class="jiathis_style_32x32">
	<a class="jiathis_button_qzone"></a>
	<a class="jiathis_button_tsina"></a>
	<a class="jiathis_button_tqq"></a>
	<a class="jiathis_button_renren"></a>
	<a class="jiathis_button_t163"></a>
	<a class="jiathis_button_hi"></a>
	<a class="jiathis_button_fb"></a>
	<a class="jiathis_button_googleplus"></a>
	<a class="jiathis_button_twitter"></a>
	<a class="jiathis_button_linkedin"></a>
	<a class="jiathis_button_reddit"></a>
	<a href="http://www.jiathis.com/share?uid=1645446" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript">
var jiathis_config = {data_track_clickback:'true'};
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1340804108559251" charset="utf-8"></script>
<!-- JiaThis Button END -->
<!-- UJian Button BEGIN -->
	<div class="ujian-hook"></div>
	<script type="text/javascript" src="http://v1.ujian.cc/code/ujian.js?type=slide&"></script>
<!-- UJian Button END -->
<!-- UY BEGIN -->
<div id="uyan_frame"></div>
<script type="text/javascript" id="UYScript" src="http://v1.uyan.cc/js/iframe.js?UYUserId=1645446" async=""></script>
<!-- UY END -->
        </div> <!-- /.span9 -->
        <div class="span3">
<a class="twitter-timeline"  href="https://twitter.com/yysfirecn" data-widget-id="277690445834895360">@yysfirecn 的推文</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
<!-- UYAN HOT ARTICLE BEGIN -->
<div id="uyan_hotate_unit"></div>
<script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=1645446"></script> <!-- 如果已经过加载此行JS，即可不用重复加载 -->
<!-- UYAN HOT ARTICLE END -->
<!-- UYAN HOT COMMENT BEGIN -->
<div id="uyan_hotcmt_unit"></div>
<!-- UYAN HOT COMMENT END -->
<!-- UYAN NEW ARTICLE BEGIN -->
<div id="uyan_newate_unit"></div>
<!-- UYAN NEW ARTICLE END -->
<!-- UYAN NEW COMMENT BEGIN -->
<div id="uyan_newcmt_unit"></div>
<!-- UYAN NEW COMMENT END -->
        </div> <!-- /.span3 -->
      </div> <!-- /.row-fluid -->

      <footer class="footer">
      <p class="pull-right"><a href="#">回到顶部</a></p>
      <div id=license>
        <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/"><img alt="知识共享许可协议" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/3.0/cn/88x31.png" /></a>
        <p>除非另有声明，本站作品由<a href="https://twitter.com/yysfirecn">@幽谷奇峰</a>创作，<br />采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/">知识共享署名-非商业性使用-相同方式共享 3.0 中国大陆许可协议</a>进行许可。
        </p>
      </div> 
      <!--/#license-->
      <p>Generated by <a href="http://code.google.com/p/vimwiki/">Vimwiki</a>. Powered by <a href="https://github.com">GitHub Pages</a>.</p>
      </footer> <!-- /footer -->
    </div> <!-- /.container-fluid -->

    <!-- Placed at the end of the document so the pages load faster -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
    <script src="../bootstrap/js/bootstrap.min.js"></script>
    <script src="../google-code-prettify/prettify.js"></script>
    <script src="../myapp.js"></script>

  </body>
</html>
